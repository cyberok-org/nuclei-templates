id: CVE-2024-23897-safecheck

info:
  name: Jenkins args4j - Arbitrary File Read
  author: chebureking
  severity: critical
  description: |
    Jenkins 2.441 and earlier, LTS 2.426.2 and earlier does not disable a feature of its CLI command parser that replaces an '@' character followed by a file path in an argument with the file's contents, allowing unauthenticated attackers to read arbitrary files on the Jenkins controller file system.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-23897
    - https://www.jenkins.io/security/advisory/2024-01-24/#SECURITY-3314
    - https://github.com/advisories/GHSA-6f9g-cxwr-q5jr
  metadata:  
    date: 26.01.2024
    expiration_date: 26.02.2024
    code_requirements:
    additional_files:
    nuclei_commandline:
    bdu-id:
    cok-id:
    template_type: safecheck
    max-request: 1
    verified: no
    shodan-query: |
      product:jenkins
      title:Jenkins
      "X-Jenkins" "X-Jenkins-Session"
      http.favicon.hash:81586312,1906162392,355818107,-1674168928
    netlas-query: |
      tag.name.keyword:("jenkins")
      http.favicon.hash_sha256:(4fec1ee82f0dc4a8e4e9bb26954cf54cf9bf1e6a009516cb6c49ff16924e8caa OR 7f31f0cdeebe5621397f6ae60526be0fd0a7805f5e00f0a7ea415eb533273a0c OR a004abcff8c741c2c904d8d2144b5db122ae8be70663e4b6e6a1f909184d96e1 OR 8f866754bce6b51ac146a8de2a23c454b63ead3edb982e358163ea6df02a659f)
    rooster-query: |
      http.favicon_hash.murmur:81586312,1906162392,355818107,-1674168928 OR product.name:"jenkins"
    fofa-query: |
      icon_hash="81586312" || icon_hash="1906162392" || icon_hash="355818107" || icon_hash="-1674168928" || "X-Jenkins" || "X-Jenkins-Session" || app="Jenkins"
    censys-query: |
      services.http.response.headers: (key: "X-Jenkins" and key:"X-Jenkins-Session")
      services.software.product=`Jenkins`
      services.http.response.favicons.md5_hash:{"23e8c7bd78e8cd826c5a6073b15068b1","59e092c63f32b2025466acb6ad342bb2","2066eb7cd7922e190e60a6124138795c","c30ca01d4e2165f24ce7dbaefdb541e8"}
    hunterhow-query: |
      header="X-Jenkins" and header="X-Jenkins-Session"
      favicon_hash=="23e8c7bd78e8cd826c5a6073b15068b1" or favicon_hash=="59e092c63f32b2025466acb6ad342bb2" or favicon_hash=="2066eb7cd7922e190e60a6124138795c" or favicon_hash=="c30ca01d4e2165f24ce7dbaefdb541e8"
      product.name=="Jenkins"
    vendor: jenkins
    product: jenkins
    accuracy: 0.9
    damage: 0.1
  
  tags: cve,cve2024,lfi,rce,jenkins


requests:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}

      - |
        @timeout: 30s
        POST /cli?remoting=false HTTP/1.1
        Host: {{Hostname}}
        Session: 39382176-ac9c-4a00-bbc6-4172b3cf1e92
        Side: download
        Content-Type: application/x-www-form-urlencoded
        Content-Length: 0
        User-Agent: Mozilla/5.0 (compatible; CyberOKInspect/1.0; +https://www.cyberok.ru/policy.html)        

    extractors:
      - type: regex
        part: header_1
        group: 1
        internal: true
        name: version
        regex:
          - 'X-Jenkins: ([\d.]+)'
          
      - type: regex
        part: header_1
        group: 1
        name: version
        regex:
          - 'X-Jenkins: ([\d.]+)'

    matchers:
      - type: dsl
        name: CVE-2024-23897
        dsl:
          - compare_versions(version, '>= 2.222.10', '< 2.427')
          - status_code_2 == 200
        condition: and
